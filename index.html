<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Inner Promise</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400&family=Space+Grotesk:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        /* --- Core Aesthetic --- */
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: #050505;
            color: #e2e8f0;
            overflow: hidden;
            touch-action: none; /* Prevents scroll on mobile */
            overscroll-behavior: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .serif { font-family: 'Cormorant Garamond', serif; }
        
        /* --- Bokeh Background --- */
        .bokeh-container {
            position: absolute;
            inset: 0;
            z-index: 0;
            overflow: hidden;
            pointer-events: none;
        }
        .bokeh-orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.15; /* Low opacity as requested */
            transition: background-color 2s ease, transform 10s ease-in-out;
            animation: float-orb 20s infinite alternate cubic-bezier(0.4, 0, 0.2, 1);
        }
        @keyframes float-orb {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(30px, -30px) scale(1.1); }
        }

        /* --- Glass Panels --- */
        .glass-panel {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* --- Text Reveal Animation --- */
        .word-reveal {
            opacity: 0;
            filter: blur(8px);
            transform: translateY(10px);
            display: inline-block;
            margin-right: 0.25em;
            transition: all 1.2s cubic-bezier(0.2, 1, 0.3, 1);
        }
        .word-reveal.visible {
            opacity: 1;
            filter: blur(0);
            transform: translateY(0);
        }

        /* --- UI Animations --- */
        .fade-enter { animation: fadeIn 1.5s ease forwards; }
        .fade-exit { animation: fadeOut 0.8s ease forwards; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }

        /* --- Progress Ring --- */
        .progress-ring__circle {
            transition: stroke-dashoffset 0.1s linear;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        /* --- Vignette --- */
        .vignette {
            position: absolute;
            inset: 0;
            pointer-events: none;
            background: radial-gradient(circle, transparent 20%, #050505 130%);
            opacity: 0.8;
            z-index: 5;
        }
    </style>
</head>
<body class="h-dvh w-full flex flex-col items-center justify-center relative">

    <audio id="bg-music" loop preload="auto">
        <source src="https://cdn.pixabay.com/download/audio/2022/03/09/audio_c8c8a73467.mp3?filename=meditation-impulse-3011.mp3" type="audio/mpeg">
    </audio>

    <div class="bokeh-container" id="bg-layer">
        <div id="orb-1" class="bokeh-orb w-[80vw] h-[80vw] top-[-20%] left-[-20%] bg-indigo-900"></div>
        <div id="orb-2" class="bokeh-orb w-[90vw] h-[90vw] bottom-[-20%] right-[-20%] bg-rose-900"></div>
    </div>

    <div class="vignette"></div>

    <main id="app-container" class="relative z-10 w-full max-w-md h-full flex flex-col items-center justify-center p-8 text-center">
        </main>

    <button id="sound-btn" class="absolute bottom-6 right-6 z-50 opacity-0 transition-opacity duration-1000 p-3 text-white/20 hover:text-white/80" onclick="toggleMute()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
        </svg>
    </button>

    <script>
        // --- Data ---
        const promises = [
            { 
                instruction: "Close your eyes. Visualize roots growing from your feet into the earth. Breathe in... and out.",
                mantra: "I am grounded. I am my own constant.",
                color: "rose" 
            },
            { 
                instruction: "Imagine a warm, golden light surrounding your entire body. You are safe here.",
                mantra: "I do not need them to see me. I see myself.",
                color: "amber" 
            },
            { 
                instruction: "Place a hand gently over your heart. Feel it beating just for you.",
                mantra: "I choose to be kind to my heart.",
                color: "pink" 
            },
            { 
                instruction: "Visualize a door opening in front of you. Light is pouring through it.",
                mantra: "I am open to the joy that is seeking me.",
                color: "emerald" 
            },
            { 
                instruction: "Think of your younger self. Imagine giving her a long, warm hug.",
                mantra: "I forgive you. You did the best you could.",
                color: "blue" 
            },
            { 
                instruction: "Imagine a shield of soft white light protecting your energy.",
                mantra: "My peace is sacred. I protect it with love.",
                color: "indigo" 
            },
            { 
                instruction: "Focus on the space between your eyebrows. Clear your mind.",
                mantra: "I trust the wisdom within my soul.",
                color: "purple" 
            },
            { 
                instruction: "Take a deep breath into your belly. Release all tension.",
                mantra: "I honor my body. I am a vessel of life.",
                color: "teal" 
            },
            { 
                instruction: "Wrap your arms around yourself. Squeeze tight.",
                mantra: "I promise to love myself, always and in all ways.",
                color: "rose" 
            }
        ];

        // --- State ---
        let currentIndex = 0;
        let isHolding = false;
        let progress = 0;
        let animationFrame;
        const audio = document.getElementById('bg-music');
        const container = document.getElementById('app-container');
        const soundBtn = document.getElementById('sound-btn');

        // --- Color Engine ---
        const colors = {
            rose: '#be123c', amber: '#b45309', pink: '#be185d', 
            emerald: '#047857', blue: '#1d4ed8', indigo: '#4338ca', 
            purple: '#7e22ce', teal: '#0f766e'
        };

        function setBokehColor(colorKey) {
            const hex = colors[colorKey] || colors.rose;
            document.getElementById('orb-1').style.backgroundColor = hex;
            document.getElementById('orb-2').style.backgroundColor = hex;
        }

        // --- Audio Logic ---
        function initAudio() {
            audio.volume = 0;
            audio.play().then(() => {
                // Fade in
                let vol = 0;
                let fade = setInterval(() => {
                    if(vol < 0.4) { vol += 0.02; audio.volume = vol; }
                    else clearInterval(fade);
                }, 100);
                soundBtn.classList.remove('opacity-0');
            }).catch(e => console.log("Audio waiting for interaction"));
        }

        function toggleMute() {
            if(audio.paused) audio.play();
            else audio.pause();
        }

        function vibrate(pattern) {
            if(navigator.vibrate) navigator.vibrate(pattern);
        }

        // --- Render: Intro ---
        function renderIntro() {
            container.innerHTML = `
                <div class="fade-enter flex flex-col items-center justify-center h-full">
                    <h1 class="serif text-5xl mb-8 gold-text tracking-widest text-white/90">Sanctuary</h1>
                    <p class="text-slate-400 text-sm mb-12 font-light tracking-wide">
                        A guided journey back to yourself.<br>Audio enabled.
                    </p>
                    <button id="start-btn" class="px-8 py-3 glass-panel rounded-full text-xs uppercase tracking-[0.2em] text-white/80 transition-all active:scale-95 hover:bg-white/10">
                        Enter
                    </button>
                </div>
            `;
            
            document.getElementById('start-btn').addEventListener('click', () => {
                initAudio();
                vibrate(50);
                transitionTo(renderInstruction);
            });
        }

        // --- Render: Step 1 (Instruction) ---
        function renderInstruction() {
            const current = promises[currentIndex];
            setBokehColor(current.color);

            container.innerHTML = `
                <div class="fade-enter flex flex-col items-center justify-center h-full w-full relative">
                    <div class="absolute top-0 text-[10px] text-white/20 tracking-[0.3em] uppercase">
                        Promise ${currentIndex + 1}
                    </div>

                    <div class="max-w-xs text-center mb-16">
                        <p class="text-[10px] text-indigo-300 uppercase tracking-widest mb-4 font-bold opacity-70">Visualize</p>
                        <p class="serif text-2xl text-slate-200 leading-relaxed font-light">
                            "${current.instruction}"
                        </p>
                    </div>

                    <div id="hold-area" class="flex flex-col items-center justify-center transition-opacity duration-500">
                        <div id="hold-trigger" class="relative w-24 h-24 flex items-center justify-center cursor-pointer touch-none select-none active:scale-95 transition-transform duration-300">
                            <div class="w-16 h-16 rounded-full border border-white/30 flex items-center justify-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white/50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 11c0 3.517-1.009 6.799-2.753 9.571m-3.44-2.04l.054-.09A13.916 13.916 0 008 11a4 4 0 118 0c0 1.017-.07 2.019-.203 3m-2.118 6.844A21.88 21.88 0 0015.171 17m3.839 1.132c.645-2.266.99-4.659.99-7.132A8 8 0 008 4.07M3 15.364c.64-1.319 1-2.8 1-4.364 0-1.457.2-2.858.571-4.182m1.51 4.182c.55 1.745 1.56 3.328 2.836 4.636M15 11h.01" />
                                </svg>
                            </div>
                            
                            <svg class="progress-ring absolute w-24 h-24 top-0 left-0" width="96" height="96">
                                <circle id="progress-circle" class="progress-ring__circle" stroke="white" stroke-width="1.5" fill="transparent" r="46" cx="48" cy="48" stroke-dasharray="289" stroke-dashoffset="289" stroke-linecap="round" />
                            </svg>
                        </div>
                        <p class="mt-4 text-[10px] text-white/30 uppercase tracking-widest">Hold to Internalize</p>
                    </div>
                </div>
            `;

            setupHoldLogic();
        }

        // --- Interaction Logic ---
        function setupHoldLogic() {
            const trigger = document.getElementById('hold-trigger');
            const circle = document.getElementById('progress-circle');
            const circumference = 2 * Math.PI * 46;

            const start = (e) => {
                if(e.cancelable) e.preventDefault();
                isHolding = true;
                vibrate(20);
                loop();
            };

            const end = (e) => {
                if(e) e.preventDefault();
                isHolding = false;
                progress = 0;
                circle.style.strokeDashoffset = circumference;
                if(animationFrame) cancelAnimationFrame(animationFrame);
            };

            const loop = () => {
                if(!isHolding) return;
                progress += 1.5; // Speed
                const offset = circumference - (progress / 100) * circumference;
                circle.style.strokeDashoffset = offset;

                if(Math.floor(progress) % 20 === 0) vibrate(5); // Tick

                if(progress >= 100) {
                    isHolding = false;
                    vibrate([40, 60]);
                    transitionTo(renderReveal);
                } else {
                    animationFrame = requestAnimationFrame(loop);
                }
            }

            trigger.addEventListener('touchstart', start, {passive: false});
            trigger.addEventListener('touchend', end);
            trigger.addEventListener('mousedown', start);
            trigger.addEventListener('mouseup', end);
            trigger.addEventListener('mouseleave', end);
        }

        // --- Render: Step 2 (The Reveal) ---
        function renderReveal() {
            const current = promises[currentIndex];
            
            // Blur out effect logic handled by transitionTo, now we render the clean state
            container.innerHTML = `
                <div class="fade-enter flex flex-col items-center justify-center h-full w-full px-6">
                    <div class="min-h-[200px] flex items-center justify-center">
                        <h2 id="mantra-text" class="serif text-3xl md:text-4xl text-white text-center leading-snug tracking-wide"></h2>
                    </div>
                    
                    <div id="next-btn-container" class="mt-12 opacity-0 transition-opacity duration-1000">
                        <button id="next-btn" class="px-6 py-2 border border-white/20 rounded-full text-[10px] uppercase tracking-[0.3em] text-white/60 hover:bg-white/5 hover:text-white transition-all">
                            Proceed
                        </button>
                    </div>
                </div>
            `;

            // Logic to type words one by one
            const textContainer = document.getElementById('mantra-text');
            const words = current.mantra.split(" ");
            textContainer.innerHTML = words.map(w => `<span class="word-reveal">${w}</span>`).join(" ");

            const spans = document.querySelectorAll('.word-reveal');
            let delay = 0;
            
            spans.forEach((span, i) => {
                setTimeout(() => {
                    span.classList.add('visible');
                    // Add subtle haptic for every word appearing
                    if(i % 2 === 0) vibrate(5);
                }, 500 + (i * 450)); // Slow, hypnotic pace
                delay = 500 + (i * 450);
            });

            // Show Next Button after text finishes
            setTimeout(() => {
                const btnContainer = document.getElementById('next-btn-container');
                btnContainer.classList.remove('opacity-0');
                
                const btn = document.getElementById('next-btn');
                btn.onclick = () => {
                    vibrate(20);
                    currentIndex++;
                    if(currentIndex < promises.length) {
                        transitionTo(renderInstruction);
                    } else {
                        transitionTo(renderFinale);
                    }
                };
            }, delay + 800);
        }

        // --- Render: Finale ---
        function renderFinale() {
            setBokehColor('rose');
            container.innerHTML = `
                <div class="fade-enter flex flex-col items-center justify-center h-full max-w-md w-full p-6">
                    <div class="w-32 h-32 rounded-full border border-white/20 flex items-center justify-center mb-10 animate-pulse">
                        <div class="w-24 h-24 rounded-full bg-white/5 blur-xl"></div>
                    </div>
                    
                    <h1 class="serif text-5xl mb-6 text-white tracking-widest">Wholeness.</h1>
                    
                    <div class="glass-panel p-8 rounded-xl border-t border-white/20 relative w-full text-center">
                        <p class="text-slate-200 text-lg leading-relaxed font-light">
                            "The soul within you trusts your biology.<br>It trusts you to carry it."
                        </p>
                        <div class="h-px w-12 bg-white/20 mx-auto my-6"></div>
                        <p class="text-rose-200 text-sm italic opacity-80">
                            You are safe with yourself now.
                        </p>
                    </div>
                    
                    <p class="mt-16 text-[10px] tracking-[0.4em] text-white/20 uppercase">Promise Day 2026</p>
                </div>
            `;
            vibrate([100, 50, 100, 50, 200]); 
        }

        // --- Transition Helper ---
        function transitionTo(renderFn) {
            // Fade out current content
            if(container.firstElementChild) {
                container.firstElementChild.classList.remove('fade-enter');
                container.firstElementChild.classList.add('fade-exit');
            }
            
            setTimeout(() => {
                container.innerHTML = '';
                renderFn();
            }, 600);
        }

        // --- Init ---
        window.addEventListener('load', renderIntro);

    </script>
</body>
</html>
