<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Inner Promise</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400&family=Space+Grotesk:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        /* --- Base & Reset --- */
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: #020202;
            color: #e2e8f0;
            overflow: hidden;
            touch-action: none;
            overscroll-behavior: none;
            -webkit-tap-highlight-color: transparent;
            transition: background-color 2s ease;
        }
        
        .serif { font-family: 'Cormorant Garamond', serif; }
        
        /* --- Glassmorphism --- */
        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
        }

        /* --- Text Effects --- */
        .gold-text {
            background: linear-gradient(to bottom, #fff, #d4af37);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .word-fade {
            opacity: 0;
            filter: blur(4px);
            transition: opacity 1.5s ease, filter 1.5s ease;
            display: inline-block;
            margin-right: 0.25em;
        }
        .word-fade.visible {
            opacity: 1;
            filter: blur(0);
        }

        /* --- Animations --- */
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-8px); } }
        @keyframes breathe-guide { 
            0%, 100% { transform: scale(1); opacity: 0.3; } 
            50% { transform: scale(1.3); opacity: 0.6; } 
        }
        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0; }
            50% { opacity: 0.5; }
            100% { transform: scale(1.5); opacity: 0; }
        }

        /* --- Transitions --- */
        .fade-enter-active { animation: fadeIn 1.5s ease forwards; }
        .fade-exit-active { animation: fadeOut 1s ease forwards; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }

        /* --- UI Elements --- */
        .progress-ring__circle {
            transition: stroke-dashoffset 0.1s linear;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        /* Vignette Overlay */
        .vignette {
            position: absolute;
            inset: 0;
            pointer-events: none;
            background: radial-gradient(circle, transparent 40%, #000 120%);
            opacity: 0.6;
            z-index: 5;
        }
    </style>
</head>
<body class="h-dvh w-full flex flex-col items-center justify-center relative">

    <audio id="bg-music" loop>
        <source src="https://cdn.pixabay.com/audio/2022/05/16/audio_db6591201e.mp3" type="audio/mpeg">
    </audio>

    <div class="absolute inset-0 z-0 pointer-events-none overflow-hidden transition-colors duration-1000" id="bg-layer">
        <div id="orb-1" class="absolute top-[-10%] left-[-10%] w-[70vh] h-[70vh] rounded-full bg-indigo-900/10 blur-[120px] transition-all duration-[3000ms]"></div>
        <div id="orb-2" class="absolute bottom-[-10%] right-[-10%] w-[70vh] h-[70vh] rounded-full bg-rose-900/10 blur-[120px] transition-all duration-[3000ms]"></div>
        <div id="particles" class="absolute inset-0 opacity-50"></div>
    </div>

    <div class="vignette"></div>

    <main id="app-container" class="relative z-10 w-full max-w-md h-full flex flex-col items-center justify-center p-6 text-center">
        </main>

    <div id="sound-control" class="absolute bottom-6 right-6 z-50 opacity-0 transition-opacity duration-1000">
        <button onclick="toggleMute()" class="text-white/30 hover:text-white/80 transition-colors">
            <svg id="sound-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
            </svg>
        </button>
    </div>

    <script>
        // --- Configuration ---
        const affirmations = [
            { 
                step: "Anchor",
                instruction: "Close your eyes. Visualize your feet growing roots into the earth.",
                mantra: "I am not going anywhere. I am my own constant.",
                color: "rose" 
            },
            { 
                step: "Validation",
                instruction: "Breathe in deeply. Imagine a mirror in front of you.",
                mantra: "I do not need them to see me. I see myself.",
                color: "indigo" 
            },
            { 
                step: "Softness",
                instruction: "Place a hand over your heart. Feel its rhythm.",
                mantra: "I will speak to myself with the gentleness I give to others.",
                color: "emerald" 
            },
            { 
                step: "Deserving",
                instruction: "Unclench your jaw. Drop your shoulders.",
                mantra: "I am allowed to be happy here. I belong in the light.",
                color: "amber" 
            },
            { 
                step: "Forgiveness",
                instruction: "Visualize your past self. Give her a hug.",
                mantra: "I forgive you. You did the best you could.",
                color: "blue" 
            },
            { 
                step: "Boundaries",
                instruction: "Imagine a golden shield surrounding your body.",
                mantra: "My peace is expensive. I will not sell it for approval.",
                color: "slate" 
            },
            { 
                step: "Trust",
                instruction: "Focus on the space between your eyebrows.",
                mantra: "My soul knows the way. I trust my biology.",
                color: "purple" 
            },
            { 
                step: "Wellness",
                instruction: "Take a deep breath into your belly.",
                mantra: "I am the vessel. I will honor my rest.",
                color: "teal" 
            },
            { 
                step: "Union",
                instruction: "Wrap your arms around yourself. Squeeze tight.",
                mantra: "I promise to be the love of my own life.",
                color: "pink" 
            }
        ];

        // --- State Management ---
        let currentStep = 0;
        let isHolding = false;
        let progress = 0;
        let animationFrame;
        const audio = document.getElementById('bg-music');
        const container = document.getElementById('app-container');

        // --- Audio Engine ---
        function startAudio() {
            audio.volume = 0;
            audio.play().then(() => {
                // Fade in audio
                let vol = 0;
                const interval = setInterval(() => {
                    if (vol < 0.5) {
                        vol += 0.05;
                        audio.volume = vol;
                    } else {
                        clearInterval(interval);
                    }
                }, 200);
                document.getElementById('sound-control').classList.remove('opacity-0');
            }).catch(e => console.log("Audio requires interaction"));
        }

        function toggleMute() {
            if (audio.paused) audio.play();
            else audio.pause();
        }

        // --- Haptics ---
        const vibrate = (pattern) => {
            if (navigator.vibrate) navigator.vibrate(pattern);
        };

        // --- Visual Effects ---
        function updateTheme(colorName) {
            const colors = {
                rose: '#be123c', indigo: '#4338ca', emerald: '#047857',
                amber: '#b45309', blue: '#1d4ed8', slate: '#475569',
                purple: '#7e22ce', teal: '#0f766e', pink: '#be185d'
            };
            const c = colors[colorName] || colors.rose;
            
            // Slow Morph
            document.getElementById('orb-1').style.backgroundColor = c + '40'; // 40 is hex opacity
            document.getElementById('orb-2').style.backgroundColor = c + '40';
        }

        // --- Text Animator (Word by Word Fade) ---
        function renderText(element, text, delayStart = 0) {
            const words = text.split(" ");
            element.innerHTML = words.map(w => `<span class="word-fade">${w}</span>`).join(" ");
            
            const spans = element.querySelectorAll('.word-fade');
            spans.forEach((span, index) => {
                setTimeout(() => {
                    span.classList.add('visible');
                }, delayStart + (index * 300)); // 300ms per word
            });
            
            // Return total duration for timing next events
            return delayStart + (words.length * 300);
        }

        // --- View: Intro ---
        function renderIntro() {
            container.innerHTML = `
                <div class="fade-enter-active flex flex-col items-center justify-center h-full">
                    <div class="mb-8 w-24 h-24 rounded-full border border-white/10 flex items-center justify-center relative">
                        <div class="absolute inset-0 rounded-full animate-[pulse-ring_3s_infinite]"></div>
                        <svg class="w-8 h-8 text-white/50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"></path></svg>
                    </div>
                    <h1 class="serif text-4xl mb-6 gold-text tracking-widest">Sanctuary</h1>
                    <p class="text-slate-400 text-sm mb-12 max-w-[260px] leading-relaxed font-light opacity-80">
                        This is a guided hypnosis for your soul.<br><br>Please use headphones.
                    </p>
                    
                    <button id="start-btn" class="px-10 py-4 glass-panel rounded-full text-xs uppercase tracking-[0.2em] text-white/80 transition-all active:scale-95 hover:bg-white/5">
                        Enter Silence
                    </button>
                </div>
            `;
            
            document.getElementById('start-btn').addEventListener('click', () => {
                startAudio();
                vibrate(50);
                transitionTo(renderBreathe);
            });
        }

        // --- View: Breathing Guide ---
        function renderBreathe() {
            container.innerHTML = `
                <div class="fade-enter-active flex flex-col items-center justify-center h-full">
                    <div class="relative w-40 h-40 flex items-center justify-center">
                        <div class="absolute inset-0 rounded-full bg-white/5 animate-[breathe-guide_8s_infinite_ease-in-out]"></div>
                        <div class="absolute inset-4 rounded-full border border-white/10"></div>
                        <div class="w-2 h-2 bg-white rounded-full"></div>
                    </div>
                    <div class="mt-12 h-16 flex items-center justify-center">
                        <p id="guide-text" class="serif text-2xl text-white/90"></p>
                    </div>
                </div>
            `;

            const textEl = document.getElementById('guide-text');
            
            // Sequence
            setTimeout(() => { textEl.innerText = "Inhale..."; }, 500);
            setTimeout(() => { textEl.innerText = "Hold..."; }, 4500);
            setTimeout(() => { textEl.innerText = "Release..."; vibrate(100); }, 6500);
            
            setTimeout(() => { 
                transitionTo(renderApology); 
            }, 10000);
        }

        // --- View: The Release (Apology) ---
        function renderApology() {
            container.innerHTML = `
                <div class="fade-enter-active flex flex-col items-center justify-center h-full w-full px-6">
                    <p class="text-xs text-white/30 uppercase tracking-[0.3em] mb-8">Phase 1: Release</p>
                    
                    <div class="min-h-[160px] flex flex-col items-center justify-center text-center">
                        <p id="apology-instruction" class="text-sm text-indigo-200 italic mb-6 font-light opacity-80"></p>
                        <h2 id="apology-mantra" class="serif text-2xl text-white leading-relaxed"></h2>
                    </div>

                    <div id="action-area" class="mt-12 opacity-0 transition-opacity duration-1000">
                        <div class="w-full h-px bg-gradient-to-r from-transparent via-white/20 to-transparent mb-8"></div>
                        <p class="text-[10px] text-white/40 uppercase tracking-widest mb-4">When you are ready</p>
                        <button id="forgive-btn" class="w-full glass-panel py-4 rounded-xl text-rose-200/90 tracking-widest text-xs uppercase font-bold cursor-pointer transition-all active:scale-95">
                            I Release This Weight
                        </button>
                    </div>
                </div>
            `;

            // Sequence Timing
            const instruction = "Close your eyes. Visualize the heavy backpack you have been carrying.";
            const mantra = "I apologize to myself for waiting, for settling, and for doubting my own magic.";
            
            const t1 = renderText(document.getElementById('apology-instruction'), instruction, 500);
            
            setTimeout(() => {
                const t2 = renderText(document.getElementById('apology-mantra'), mantra, 500);
                setTimeout(() => {
                    document.getElementById('action-area').classList.remove('opacity-0');
                }, t2); // Reveal button after text finishes
            }, t1 + 1000);

            document.getElementById('forgive-btn').addEventListener('click', () => {
                vibrate([40, 50, 40]);
                transitionTo(renderAffirmations);
            });
        }

        // --- View: Affirmation Loop ---
        function renderAffirmations() {
            if (currentStep >= affirmations.length) {
                transitionTo(renderFinale);
                return;
            }

            const data = affirmations[currentStep];
            updateTheme(data.color);

            container.innerHTML = `
                <div class="fade-enter-active flex flex-col items-center justify-center h-full w-full relative px-6">
                    <div class="absolute top-8 text-[10px] text-white/30 tracking-[0.3em] uppercase">
                        Part ${currentStep + 1} of ${affirmations.length}
                    </div>

                    <div class="flex-1 flex flex-col justify-center items-center w-full max-w-sm">
                        
                        <div class="glass-panel p-6 rounded-2xl mb-8 w-full border-t border-white/10">
                            <p class="text-xs text-${data.color}-300 uppercase tracking-widest mb-3 font-bold opacity-70">Instruction</p>
                            <p id="instruction-text" class="text-sm text-slate-200 font-light italic leading-6 min-h-[40px]"></p>
                        </div>

                        <div class="min-h-[100px] flex items-center justify-center mb-8">
                            <h2 id="mantra-text" class="serif text-3xl text-white text-center leading-snug"></h2>
                        </div>
                    </div>

                    <div id="hold-area" class="h-48 flex flex-col items-center justify-center w-full relative opacity-0 transition-opacity duration-1000">
                        <div id="hold-trigger" class="relative w-24 h-24 rounded-full flex items-center justify-center cursor-pointer touch-none select-none active:scale-95 transition-transform">
                            <svg class="progress-ring absolute w-28 h-28" width="120" height="120">
                                <circle class="progress-ring__circle" stroke="rgba(255,255,255,0.05)" stroke-width="2" fill="transparent" r="46" cx="60" cy="60"/>
                                <circle id="progress-circle" class="progress-ring__circle" stroke="white" stroke-width="2" fill="transparent" r="46" cx="60" cy="60" stroke-dasharray="289" stroke-dashoffset="289" stroke-linecap="round" />
                            </svg>
                            <div class="w-20 h-20 bg-gradient-to-b from-white/10 to-transparent rounded-full backdrop-blur-sm border border-white/10 flex items-center justify-center shadow-[0_0_30px_rgba(255,255,255,0.1)]">
                                <div class="w-1 h-1 bg-white rounded-full"></div>
                            </div>
                        </div>
                        <p class="mt-6 text-[10px] text-white/30 uppercase tracking-widest">Hold to Internalize</p>
                    </div>
                </div>
            `;

            // Sequence Text
            const t1 = renderText(document.getElementById('instruction-text'), data.instruction, 500);
            
            setTimeout(() => {
                const t2 = renderText(document.getElementById('mantra-text'), data.mantra, 500);
                setTimeout(() => {
                    document.getElementById('hold-area').classList.remove('opacity-0');
                    setupHoldInteraction();
                }, t2 + 1000);
            }, t1 + 2000); // Pause between instruction and mantra
        }

        // --- Interaction Logic ---
        function setupHoldInteraction() {
            const trigger = document.getElementById('hold-trigger');
            const circle = document.getElementById('progress-circle');
            const circumference = 2 * Math.PI * 46;

            const startHold = (e) => {
                if(e.cancelable) e.preventDefault();
                isHolding = true;
                vibrate(20);
                if (animationFrame) cancelAnimationFrame(animationFrame);
                loop();
            };

            const endHold = (e) => {
                if(e && e.cancelable) e.preventDefault();
                isHolding = false;
                progress = 0;
                circle.style.strokeDashoffset = circumference;
                if (animationFrame) cancelAnimationFrame(animationFrame);
            };

            const loop = () => {
                if (!isHolding) return;
                
                progress += 0.8; // Slower, more hypnotic hold speed
                const offset = circumference - (progress / 100) * circumference;
                circle.style.strokeDashoffset = offset;

                // Gentle pulses
                if (Math.floor(progress) % 25 === 0) vibrate(5); 

                if (progress >= 100) {
                    isHolding = false;
                    vibrate([50, 100, 50]);
                    completeStep();
                } else {
                    animationFrame = requestAnimationFrame(loop);
                }
            };

            // Bind Events
            trigger.addEventListener('touchstart', startHold, {passive: false});
            trigger.addEventListener('touchend', endHold);
            trigger.addEventListener('mousedown', startHold);
            trigger.addEventListener('mouseup', endHold);
            trigger.addEventListener('mouseleave', endHold);
        }

        function completeStep() {
            const el = container.firstElementChild;
            el.classList.add('fade-exit-active');
            setTimeout(() => {
                currentStep++;
                renderAffirmations();
            }, 800);
        }

        // --- View: Finale ---
        function renderFinale() {
            updateTheme('rose');
            container.innerHTML = `
                <div class="fade-enter-active flex flex-col items-center justify-center h-full max-w-md w-full p-6">
                    <div class="w-48 h-48 rounded-full bg-gradient-to-tr from-rose-500 via-indigo-500 to-purple-500 blur-[80px] opacity-40 animate-[breathe-guide_6s_infinite_ease-in-out] mb-10"></div>
                    
                    <h1 class="serif text-5xl mb-6 gold-text">Wholeness.</h1>
                    
                    <div class="glass-panel p-8 rounded-2xl border-t border-white/20 relative w-full">
                        <p class="text-slate-200 text-lg leading-relaxed font-light mb-6">
                            "The soul within you trusts your biology.<br>It trusts you to carry it."
                        </p>
                        <div class="h-px w-full bg-white/10 mb-6"></div>
                        <p class="text-rose-200 text-sm italic opacity-80">
                            You are safe with yourself now.
                        </p>
                    </div>
                    
                    <p class="mt-12 text-[10px] tracking-[0.4em] text-white/30 uppercase">Promise Day 2026</p>
                </div>
            `;
            vibrate([100, 50, 100, 50, 200]); 
        }

        // --- Utils ---
        function transitionTo(renderFn) {
            container.innerHTML = '';
            renderFn();
        }

        // --- Init Particles ---
        const pContainer = document.getElementById('particles');
        for(let i=0; i<30; i++) {
            const d = document.createElement('div');
            d.className = 'absolute bg-white rounded-full opacity-20';
            d.style.width = Math.random() * 3 + 'px';
            d.style.height = d.style.width;
            d.style.left = Math.random() * 100 + '%';
            d.style.top = Math.random() * 100 + '%';
            d.style.animation = `float ${5 + Math.random() * 10}s infinite ease-in-out ${Math.random() * 5}s`;
            pContainer.appendChild(d);
        }

        window.addEventListener('load', renderIntro);

    </script>
</body>
</html>
