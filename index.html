<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Inner Promise</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400&family=Space+Grotesk:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        /* --- Base & Reset --- */
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: #050505;
            color: #e2e8f0;
            overflow: hidden;
            touch-action: none;
            overscroll-behavior: none;
            -webkit-tap-highlight-color: transparent;
            transition: background-color 2s ease;
        }
        
        .serif { font-family: 'Cormorant Garamond', serif; }
        
        /* --- Glassmorphism --- */
        .glass-panel {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* --- Text Effects --- */
        .gold-text {
            background: linear-gradient(to bottom, #fff, #e0c080);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .word-fade {
            opacity: 0;
            filter: blur(4px);
            transition: opacity 1.2s ease, filter 1.2s ease;
            display: inline-block;
            margin-right: 0.25em;
        }
        .word-fade.visible {
            opacity: 1;
            filter: blur(0);
        }

        /* --- Animations --- */
        @keyframes breathe-guide { 
            0%, 100% { transform: scale(1); opacity: 0.3; } 
            50% { transform: scale(1.15); opacity: 0.6; } 
        }

        /* --- Shooting Stars --- */
        .shooting-star {
            position: absolute;
            height: 1px;
            background: linear-gradient(-45deg, rgba(255,255,255,1), rgba(255,255,255,0));
            border-radius: 999px;
            filter: drop-shadow(0 0 6px rgba(255,255,255,1));
            animation: tail 3000ms ease-in-out infinite, shooting 3000ms ease-in-out infinite;
            opacity: 0;
        }

        @keyframes tail {
            0% { width: 0; }
            30% { width: 100px; }
            100% { width: 0; }
        }

        @keyframes shooting {
            0% { transform: translateX(0); opacity: 1; }
            100% { transform: translateX(-320px) translateY(320px); opacity: 0; }
        }

        /* --- UI Elements --- */
        .progress-ring__circle {
            transition: stroke-dashoffset 0.1s linear;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        /* Vignette Overlay */
        .vignette {
            position: absolute;
            inset: 0;
            pointer-events: none;
            background: radial-gradient(circle, transparent 30%, #000 130%);
            opacity: 0.5;
            z-index: 5;
        }
    </style>
</head>
<body class="h-dvh w-full flex flex-col items-center justify-center relative">

    <audio id="bg-music" loop>
        <source src="https://cdn.pixabay.com/download/audio/2022/10/25/audio_13a3780302.mp3?filename=angelic-pad-123497.mp3" type="audio/mpeg">
    </audio>

    <div class="absolute inset-0 z-0 pointer-events-none overflow-hidden transition-colors duration-1000" id="bg-layer">
        <div id="orb-1" class="absolute top-[-10%] left-[-10%] w-[80vh] h-[80vh] rounded-full bg-indigo-900/10 blur-[150px] transition-all duration-[3000ms]"></div>
        <div id="orb-2" class="absolute bottom-[-10%] right-[-10%] w-[80vh] h-[80vh] rounded-full bg-rose-900/10 blur-[150px] transition-all duration-[3000ms]"></div>
        
        <div id="stars" class="absolute inset-0"></div>
    </div>

    <div class="vignette"></div>

    <main id="app-container" class="relative z-10 w-full max-w-md h-full flex flex-col items-center justify-center p-6 text-center">
        </main>

    <div id="sound-control" class="absolute bottom-8 right-8 z-50 opacity-0 transition-opacity duration-1000">
        <button onclick="toggleMute()" class="text-white/20 hover:text-white/60 transition-colors">
            <svg id="sound-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
            </svg>
        </button>
    </div>

    <script>
        // --- Configuration: Positive & Uplifting ---
        const affirmations = [
            { 
                step: "Anchor",
                instruction: "Close your eyes. Feel your feet connecting with the earth.",
                mantra: "I am grounded. I am my own constant.",
                color: "rose" 
            },
            { 
                step: "Validation",
                instruction: "Take a deep breath. Imagine a warm light surrounding you.",
                mantra: "I am whole. I radiate my own light.",
                color: "amber" 
            },
            { 
                step: "Softness",
                instruction: "Place a hand over your heart. Feel its gentle rhythm.",
                mantra: "I choose to be kind to my heart.",
                color: "pink" 
            },
            { 
                step: "Abundance",
                instruction: "Open your palms upward. Release any tension.",
                mantra: "I am open to the joy that is seeking me.",
                color: "emerald" 
            },
            { 
                step: "Embrace",
                instruction: "Visualize your journey as a beautiful path.",
                mantra: "I honor how far I have come. I am proud of me.",
                color: "blue" 
            },
            { 
                step: "Boundaries",
                instruction: "Imagine a golden shield of peace around you.",
                mantra: "My peace is sacred. I protect it with love.",
                color: "indigo" 
            },
            { 
                step: "Intuition",
                instruction: "Focus on the space between your eyebrows.",
                mantra: "I trust the wisdom within my soul.",
                color: "purple" 
            },
            { 
                step: "Vitality",
                instruction: "Breathe deeply into your belly.",
                mantra: "I honor my body. I am a vessel of life.",
                color: "teal" 
            },
            { 
                step: "Union",
                instruction: "Wrap your arms around yourself in a warm hug.",
                mantra: "I promise to love myself, always and in all ways.",
                color: "rose" 
            }
        ];

        // --- State Management ---
        let currentStep = 0;
        let isHolding = false;
        let progress = 0;
        let animationFrame;
        const audio = document.getElementById('bg-music');
        const container = document.getElementById('app-container');

        // --- Audio Engine ---
        function startAudio() {
            audio.volume = 0;
            audio.play().then(() => {
                let vol = 0;
                const interval = setInterval(() => {
                    if (vol < 0.6) { vol += 0.05; audio.volume = vol; } 
                    else { clearInterval(interval); }
                }, 200);
                document.getElementById('sound-control').classList.remove('opacity-0');
            }).catch(e => console.log("Audio requires interaction"));
        }

        function toggleMute() {
            if (audio.paused) audio.play();
            else audio.pause();
        }

        // --- Haptics ---
        const vibrate = (pattern) => { if (navigator.vibrate) navigator.vibrate(pattern); };

        // --- Visual Effects ---
        function updateTheme(colorName) {
            const colors = {
                rose: '#be123c', indigo: '#4338ca', emerald: '#047857',
                amber: '#b45309', blue: '#1d4ed8', purple: '#7e22ce', 
                teal: '#0f766e', pink: '#be185d'
            };
            const c = colors[colorName] || colors.rose;
            
            document.getElementById('orb-1').style.backgroundColor = c + '30'; 
            document.getElementById('orb-2').style.backgroundColor = c + '30';
        }

        // --- Text Animator ---
        function renderText(element, text, delayStart = 0) {
            const words = text.split(" ");
            element.innerHTML = words.map(w => `<span class="word-fade">${w}</span>`).join(" ");
            
            const spans = element.querySelectorAll('.word-fade');
            spans.forEach((span, index) => {
                setTimeout(() => { span.classList.add('visible'); }, delayStart + (index * 350));
            });
            return delayStart + (words.length * 350);
        }

        // --- View: Intro ---
        function renderIntro() {
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full animate-[fadeIn_2s_ease]">
                    <h1 class="serif text-5xl mb-6 gold-text tracking-widest opacity-90">Sanctuary</h1>
                    <p class="text-slate-400 text-sm mb-12 max-w-[260px] leading-relaxed font-light opacity-80">
                        A guided journey back to yourself.<br><br>Please use headphones.
                    </p>
                    
                    <button id="start-btn" class="group relative w-16 h-16 rounded-full border border-white/20 flex items-center justify-center transition-all active:scale-95">
                        <div class="absolute inset-0 rounded-full border border-white/50 opacity-0 group-hover:opacity-100 transition-opacity scale-110"></div>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white/80" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </button>
                    <p class="mt-8 text-[10px] text-white/30 uppercase tracking-[0.3em]">Begin</p>
                </div>
            `;
            
            document.getElementById('start-btn').addEventListener('click', () => {
                startAudio();
                vibrate(50);
                transitionTo(renderBreathe);
            });
        }

        // --- View: Breathing ---
        function renderBreathe() {
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full animate-[fadeIn_2s_ease]">
                    <div class="relative w-40 h-40 flex items-center justify-center">
                        <div class="absolute inset-0 rounded-full bg-white/5 animate-[breathe-guide_8s_infinite_ease-in-out]"></div>
                        <div class="absolute inset-0 rounded-full border border-white/10 opacity-50"></div>
                    </div>
                    <div class="mt-12 h-16 flex items-center justify-center">
                        <p id="guide-text" class="serif text-2xl text-white/90"></p>
                    </div>
                </div>
            `;

            const textEl = document.getElementById('guide-text');
            setTimeout(() => { textEl.innerText = "Inhale..."; }, 500);
            setTimeout(() => { textEl.innerText = "Exhale..."; vibrate(30); }, 4500);
            setTimeout(() => { transitionTo(renderWelcome); }, 9000);
        }

        // --- View: The Reconnection (Replaces Apology) ---
        function renderWelcome() {
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full w-full px-6 animate-[fadeIn_2s_ease]">
                    <div class="min-h-[160px] flex flex-col items-center justify-center text-center">
                        <p id="welcome-instruction" class="text-sm text-indigo-200 italic mb-8 font-light opacity-80"></p>
                        <h2 id="welcome-mantra" class="serif text-2xl text-white leading-relaxed"></h2>
                    </div>

                    <div id="action-area" class="mt-16 opacity-0 transition-opacity duration-1000 flex flex-col items-center">
                         <div id="reconnect-btn" class="relative w-20 h-20 rounded-full border border-white/30 flex items-center justify-center cursor-pointer active:scale-95 transition-transform touch-none select-none">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white/50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 11c0 3.517-1.009 6.799-2.753 9.571m-3.44-2.04l.054-.09A13.916 13.916 0 008 11a4 4 0 118 0c0 1.017-.07 2.019-.203 3m-2.118 6.844A21.88 21.88 0 0015.171 17m3.839 1.132c.645-2.266.99-4.659.99-7.132A8 8 0 008 4.07M3 15.364c.64-1.319 1-2.8 1-4.364 0-1.457.2-2.858.571-4.182m1.51 4.182c.55 1.745 1.56 3.328 2.836 4.636M15 11h.01" />
                            </svg>
                            <svg class="progress-ring absolute w-20 h-20 top-0 left-0" width="80" height="80">
                                <circle id="welcome-circle" class="progress-ring__circle" stroke="white" stroke-width="1" fill="transparent" r="39" cx="40" cy="40" stroke-dasharray="245" stroke-dashoffset="245" stroke-linecap="round" />
                            </svg>
                        </div>
                        <p class="mt-4 text-[10px] text-white/30 uppercase tracking-widest">Hold to Reconnect</p>
                    </div>
                </div>
            `;

            const instruction = "Close your eyes. Visualize a beautiful light within you that has never flickered.";
            const mantra = "I am ready to reconnect with my own brilliance.";
            
            const t1 = renderText(document.getElementById('welcome-instruction'), instruction, 500);
            
            setTimeout(() => {
                const t2 = renderText(document.getElementById('welcome-mantra'), mantra, 500);
                setTimeout(() => {
                    document.getElementById('action-area').classList.remove('opacity-0');
                    setupSimpleHold(document.getElementById('reconnect-btn'), document.getElementById('welcome-circle'), renderAffirmations);
                }, t2 + 500); 
            }, t1 + 1000);
        }

        // --- View: Affirmation Loop ---
        function renderAffirmations() {
            if (currentStep >= affirmations.length) {
                transitionTo(renderFinale);
                return;
            }

            const data = affirmations[currentStep];
            updateTheme(data.color);

            container.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full w-full relative px-6 animate-[fadeIn_1.5s_ease]">
                    <div class="absolute top-8 text-[10px] text-white/20 tracking-[0.3em] uppercase">
                        ${currentStep + 1} / ${affirmations.length}
                    </div>

                    <div class="flex-1 flex flex-col justify-center items-center w-full max-w-sm">
                        
                        <div class="glass-panel p-6 rounded-xl mb-10 w-full border-t border-white/10">
                            <p class="text-[10px] text-${data.color}-300 uppercase tracking-widest mb-3 font-bold opacity-60">Visualize</p>
                            <p id="instruction-text" class="text-sm text-slate-200 font-light italic leading-6 min-h-[40px]"></p>
                        </div>

                        <div class="min-h-[100px] flex items-center justify-center mb-10">
                            <h2 id="mantra-text" class="serif text-3xl text-white text-center leading-snug"></h2>
                        </div>
                    </div>

                    <div id="hold-area" class="h-40 flex flex-col items-center justify-center w-full relative opacity-0 transition-opacity duration-1000">
                        
                        <div id="hold-trigger" class="relative w-20 h-20 rounded-full border border-white/20 flex items-center justify-center cursor-pointer active:scale-95 transition-transform touch-none select-none bg-transparent">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white/40" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 11c0 3.517-1.009 6.799-2.753 9.571m-3.44-2.04l.054-.09A13.916 13.916 0 008 11a4 4 0 118 0c0 1.017-.07 2.019-.203 3m-2.118 6.844A21.88 21.88 0 0015.171 17m3.839 1.132c.645-2.266.99-4.659.99-7.132A8 8 0 008 4.07M3 15.364c.64-1.319 1-2.8 1-4.364 0-1.457.2-2.858.571-4.182m1.51 4.182c.55 1.745 1.56 3.328 2.836 4.636M15 11h.01" />
                            </svg>
                            
                            <svg class="progress-ring absolute w-20 h-20 top-0 left-0" width="80" height="80">
                                <circle id="progress-circle" class="progress-ring__circle" stroke="white" stroke-width="1.5" fill="transparent" r="39" cx="40" cy="40" stroke-dasharray="245" stroke-dashoffset="245" stroke-linecap="round" />
                            </svg>
                        </div>
                        
                        <p class="mt-4 text-[10px] text-white/30 uppercase tracking-widest">Hold to Internalize</p>
                    </div>
                </div>
            `;

            // Sequence Text
            const t1 = renderText(document.getElementById('instruction-text'), data.instruction, 500);
            
            setTimeout(() => {
                const t2 = renderText(document.getElementById('mantra-text'), data.mantra, 500);
                setTimeout(() => {
                    document.getElementById('hold-area').classList.remove('opacity-0');
                    setupSimpleHold(document.getElementById('hold-trigger'), document.getElementById('progress-circle'), completeStep);
                }, t2 + 1000);
            }, t1 + 2000);
        }

        // --- Interaction Logic ---
        function setupSimpleHold(trigger, circle, callback) {
            const circumference = 2 * Math.PI * 39;
            
            const startHold = (e) => {
                if(e.cancelable) e.preventDefault();
                isHolding = true;
                vibrate(20);
                if (animationFrame) cancelAnimationFrame(animationFrame);
                loop();
            };

            const endHold = (e) => {
                if(e && e.cancelable) e.preventDefault();
                isHolding = false;
                progress = 0;
                circle.style.strokeDashoffset = circumference;
                if (animationFrame) cancelAnimationFrame(animationFrame);
            };

            const loop = () => {
                if (!isHolding) return;
                
                progress += 0.8; 
                const offset = circumference - (progress / 100) * circumference;
                circle.style.strokeDashoffset = offset;

                if (Math.floor(progress) % 20 === 0) vibrate(5); 

                if (progress >= 100) {
                    isHolding = false;
                    vibrate([50, 100, 50]);
                    callback();
                } else {
                    animationFrame = requestAnimationFrame(loop);
                }
            };

            trigger.addEventListener('touchstart', startHold, {passive: false});
            trigger.addEventListener('touchend', endHold);
            trigger.addEventListener('mousedown', startHold);
            trigger.addEventListener('mouseup', endHold);
            trigger.addEventListener('mouseleave', endHold);
        }

        function completeStep() {
            container.firstElementChild.style.opacity = '0';
            setTimeout(() => {
                currentStep++;
                renderAffirmations();
            }, 800);
        }

        // --- View: Finale ---
        function renderFinale() {
            updateTheme('rose');
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full max-w-md w-full p-6 animate-[fadeIn_2s_ease]">
                    <div class="w-48 h-48 rounded-full bg-gradient-to-tr from-rose-500 via-indigo-500 to-amber-500 blur-[80px] opacity-40 animate-[breathe-guide_6s_infinite_ease-in-out] mb-10"></div>
                    
                    <h1 class="serif text-5xl mb-6 gold-text">Wholeness.</h1>
                    
                    <div class="glass-panel p-8 rounded-2xl border-t border-white/20 relative w-full text-center">
                        <p class="text-slate-200 text-lg leading-relaxed font-light mb-6">
                            "The soul within you trusts your biology.<br>It trusts you to carry it."
                        </p>
                        <div class="h-px w-16 bg-white/20 mx-auto mb-6"></div>
                        <p class="text-rose-200 text-sm italic opacity-80">
                            You are safe with yourself now.
                        </p>
                    </div>
                    
                    <p class="mt-12 text-[10px] tracking-[0.4em] text-white/30 uppercase">Promise Day 2026</p>
                </div>
            `;
            vibrate([100, 50, 100, 50, 200]); 
        }

        // --- Utils ---
        function transitionTo(renderFn) {
            container.innerHTML = '';
            renderFn();
        }

        // --- Init Shooting Stars ---
        const starContainer = document.getElementById('stars');
        function createStars() {
            for(let i=0; i<3; i++) {
                const s = document.createElement('div');
                s.className = 'shooting-star';
                s.style.top = Math.random() * 50 + '%';
                s.style.left = Math.random() * 80 + 20 + '%';
                s.style.animationDelay = Math.random() * 5 + 's';
                starContainer.appendChild(s);
            }
        }
        createStars();
        setInterval(createStars, 6000); // Add more occasionally

        window.addEventListener('load', renderIntro);

    </script>
</body>
</html>
