<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>9 Promises</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,400&family=Space+Grotesk:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        /* --- Base Settings --- */
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-color: #000000;
            color: #e2e8f0;
            overflow: hidden;
            touch-action: none;
            overscroll-behavior: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        
        .serif { font-family: 'Cormorant Garamond', serif; }
        
        /* --- Background Effects --- */
        .bokeh-container {
            position: absolute;
            inset: 0;
            z-index: 0;
            pointer-events: none;
            opacity: 0.5;
            transition: opacity 2s ease;
        }
        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(120px);
            transition: background-color 3s ease;
            animation: float 20s infinite alternate;
            opacity: 0.4;
        }
        @keyframes float { 0% { transform: translate(0,0); } 100% { transform: translate(40px, -40px); } }

        /* --- Glass UI --- */
        .glass-box {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 20px 50px rgba(0,0,0,0.6);
        }

        /* --- Text Animations --- */
        .gold-text {
            background: linear-gradient(to bottom, #fff, #e0c080);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Word-by-Word Blur Fade */
        .word-blur {
            opacity: 0;
            filter: blur(12px);
            transform: translateY(5px);
            display: inline-block;
            margin-right: 0.25em; /* Space between words */
            transition: all 1.2s cubic-bezier(0.2, 1, 0.3, 1);
        }
        .word-blur.visible {
            opacity: 1;
            filter: blur(0);
            transform: translateY(0);
        }

        /* Sentence-by-Sentence Blur Fade (For Visuals) */
        .line-blur {
            opacity: 0;
            filter: blur(10px);
            transition: all 1.5s ease;
        }
        .line-blur.visible {
            opacity: 1;
            filter: blur(0);
        }

        /* --- General Transitions --- */
        .fade-enter { animation: fadeIn 2s ease forwards; }
        .fade-exit { animation: fadeOut 1s ease forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }

        /* --- UI Components --- */
        .progress-ring__circle {
            transition: stroke-dashoffset 0.1s linear;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .vignette {
            position: absolute;
            inset: 0;
            background: radial-gradient(circle, transparent 30%, #000 130%);
            z-index: 2;
            pointer-events: none;
        }
    </style>
</head>
<body class="h-dvh w-full flex flex-col items-center justify-center relative">

    <audio id="bg-music" loop preload="auto">
        <source src="https://cdn.pixabay.com/download/audio/2022/11/22/audio_febc508520.mp3?filename=ethereal-meditation-126284.mp3" type="audio/mpeg">
    </audio>

    <div class="bokeh-container">
        <div id="orb1" class="orb w-[90vw] h-[90vw] top-[-20%] left-[-20%] bg-white/10"></div>
        <div id="orb2" class="orb w-[100vw] h-[100vw] bottom-[-20%] right-[-20%] bg-white/5"></div>
    </div>
    <div class="vignette"></div>

    <main id="app-container" class="relative z-10 w-full max-w-md h-full flex flex-col items-center justify-center p-6 text-center">
        </main>

    <script>
        // --- Content Data ---
        const promises = [
            {
                visual: "Imagine yourself as a great, ancient tree standing alone in a vast field. A storm comes—wind screams, rain lashes—but your roots go so deep into the earth that you do not sway. You are not holding onto the ground; you are part of it.",
                mantra: "I am grounded. I am my own constant.",
                color: "#881337" // Deep Rose
            },
            {
                visual: "Visualize a mirror in front of you. See your reflection, but strip away the makeup, the filters, and the exhaustion. Look into your own eyes until you see the little girl hiding behind them. Smile at her. She has been waiting for you to see her.",
                mantra: "I do not need them to see me. I see myself.",
                color: "#b45309" // Amber
            },
            {
                visual: "Imagine your heart is a small, fragile bird resting in your hands. It has been bruised by harsh words—some from others, but most from you. Gently stroke its feathers. Apologize to it. Promise to protect it from your own cruelty.",
                mantra: "I will speak to myself with kindness.",
                color: "#be185d" // Pink
            },
            {
                visual: "Picture a heavy iron door in your chest that you’ve kept locked to keep pain out. But it has also kept the sun out. Visualize yourself slowly turning the key. It’s scary, but you push it open. Warm, golden light floods in.",
                mantra: "I am open to the joy that is seeking me.",
                color: "#047857" // Emerald
            },
            {
                visual: "Summon the version of you from your lowest moment. The one who was crying on the floor, feeling entirely alone. Walk up to her. Sit beside her. Wrap your arms around her and whisper, 'I'm here now. We made it.'",
                mantra: "I forgive you. You did the best you could.",
                color: "#1e3a8a" // Blue
            },
            {
                visual: "Imagine a circle drawn in gold dust around your feet. Inside this circle, the air is clean and quiet. Outside is the noise of the world. You realize you are the gatekeeper. Nothing enters this circle without your permission.",
                mantra: "My peace is sacred. I protect it.",
                color: "#5b21b6" // Indigo
            },
            {
                visual: "Imagine you are standing in a library filled with all the books of your life. There is a quiet whisper that has always guided you to the right page, even when you were lost. It is not loud, but it is true. Listen to it now.",
                mantra: "I trust the wisdom within my soul.",
                color: "#134e4a" // Teal
            },
            {
                visual: "Look at your hands. Look at your legs. They have carried you through every heartbreak, every illness, every long night. They never gave up on you. Imagine kissing your own hands in gratitude.",
                mantra: "I honor this vessel. I am alive.",
                color: "#9f1239" // Red
            },
            {
                visual: "Imagine standing at an altar. There is no groom or bride waiting for you. There is just you, waiting for you. You take your own hands. You look into your own eyes. You say, 'I do.'",
                mantra: "I am the love of my own life.",
                color: "#ffffff" // White
            }
        ];

        // --- State Variables ---
        let currentIdx = 0;
        let isHolding = false;
        let progress = 0;
        let animFrame;
        const container = document.getElementById('app-container');
        const audio = document.getElementById('bg-music');

        // --- Utilities ---
        const vibrate = (p) => { if(navigator.vibrate) navigator.vibrate(p); };
        
        const setColor = (c) => {
            document.getElementById('orb1').style.backgroundColor = c;
            document.getElementById('orb2').style.backgroundColor = c;
        };

        // --- Helper: Word-by-Word Animation ---
        function renderWordByWord(element, text, delayStart = 0) {
            const words = text.split(" ");
            element.innerHTML = words.map(w => `<span class="word-blur">${w}</span>`).join("");
            
            const spans = element.querySelectorAll('.word-blur');
            let totalDelay = 0;
            
            spans.forEach((span, i) => {
                const delay = delayStart + (i * 300); // 300ms per word
                totalDelay = delay;
                setTimeout(() => {
                    span.classList.add('visible');
                }, delay);
            });
            return totalDelay;
        }

        // --- SCENE 1: Instructions ---
        function renderInstructions() {
            container.innerHTML = `
                <div class="fade-enter w-full flex flex-col items-center">
                    <div class="glass-box p-10 rounded-xl w-full mb-12 text-left relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-1 h-full bg-white/50"></div>
                        <h2 class="serif text-2xl text-white mb-6 tracking-wide">Preparation</h2>
                        <p class="text-sm text-slate-300 leading-8 mb-6 font-light">
                            This experience is best enabled through headphones. Ensure you are in a comfortable environment, away from distractions.
                        </p>
                        <p class="text-sm text-slate-300 leading-8 font-light">
                            Each screen contains visualizations to imagine with your eyes closed, while focusing on long, deep breaths (3 deep breaths are recommended).
                        </p>
                    </div>
                    <button id="ready-btn" class="group relative px-10 py-4 border border-white/20 rounded-full transition-all active:scale-95 hover:bg-white/5">
                        <span class="text-xs tracking-[0.3em] uppercase group-hover:text-white transition-colors">I Am Ready</span>
                    </button>
                </div>
            `;
            
            // Audio trigger integrated here
            document.getElementById('ready-btn').addEventListener('click', () => {
                audio.volume = 0;
                const playPromise = audio.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(_ => {
                        // Fade audio in
                        let vol = 0;
                        let fade = setInterval(() => {
                            if(vol < 0.6) { vol += 0.05; audio.volume = vol; }
                            else clearInterval(fade);
                        }, 200);
                    }).catch(error => {
                        console.log("Audio play failed (browser restriction).");
                    });
                }
                
                vibrate(50);
                transitionTo(renderTitle);
            });
        }

        // --- SCENE 2: Title Card ---
        function renderTitle() {
            container.innerHTML = `
                <div class="fade-enter flex flex-col items-center justify-center h-full">
                    <h1 class="serif text-5xl md:text-6xl text-white tracking-widest mb-6" id="title-text"></h1>
                    <div class="h-px w-0 bg-white/50 mb-12 animate-[widthGrow_2s_ease_forwards_2s]"></div>
                    
                    <button id="enter-btn" class="opacity-0 animate-[fadeIn_1s_ease_forwards_3s] text-xs uppercase tracking-[0.4em] text-white/50 hover:text-white transition-colors p-4">
                        Enter
                    </button>
                </div>
                <style>@keyframes widthGrow { from { w: 0; } to { width: 100px; } }</style>
            `;
            
            // Render title word by word
            renderWordByWord(document.getElementById('title-text'), "9 PROMISES", 500);
            
            document.getElementById('enter-btn').addEventListener('click', () => {
                vibrate(50);
                transitionTo(renderExperience);
            });
        }

        // --- SCENE 3: Visualization Loop ---
        function renderExperience() {
            const data = promises[currentIdx];
            setColor(data.color);

            container.innerHTML = `
                <div class="fade-enter w-full flex flex-col items-center justify-between h-[85vh]">
                    <div class="text-[10px] tracking-[0.4em] uppercase text-white/30 mt-4">
                        Promise ${currentIdx + 1}
                    </div>

                    <div class="glass-box p-10 rounded-2xl w-full min-h-[320px] flex flex-col justify-center relative my-4">
                        <div class="absolute -top-3 left-8 bg-black px-2 text-[10px] text-white/50 uppercase tracking-widest border border-white/10 rounded-full">Visualize</div>
                        <div id="vis-text" class="serif text-xl md:text-2xl text-slate-100 leading-loose font-light">
                            </div>
                    </div>

                    <div class="flex flex-col items-center justify-center mb-8 opacity-0 transition-opacity duration-1000" id="action-area">
                        <p class="text-[10px] text-white/40 leading-relaxed text-center max-w-[280px] mb-8 font-light">
                            Close your eyes, visualize this clearly, and breathe slowly. When you are ready to move on, open your eyes and use the button below.
                        </p>
                        
                        <div id="hold-btn" class="relative w-24 h-24 flex items-center justify-center cursor-pointer active:scale-95 transition-transform touch-none select-none">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white/30" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="0.5" d="M12 11c0 3.517-1.009 6.799-2.753 9.571m-3.44-2.04l.054-.09A13.916 13.916 0 008 11a4 4 0 118 0c0 1.017-.07 2.019-.203 3m-2.118 6.844A21.88 21.88 0 0015.171 17m3.839 1.132c.645-2.266.99-4.659.99-7.132A8 8 0 008 4.07M3 15.364c.64-1.319 1-2.8 1-4.364 0-1.457.2-2.858.571-4.182m1.51 4.182c.55 1.745 1.56 3.328 2.836 4.636M15 11h.01" />
                            </svg>
                            <svg class="absolute w-24 h-24 rotate-[-90deg]">
                                <circle class="text-white/10" stroke-width="1" stroke="currentColor" fill="transparent" r="46" cx="48" cy="48"/>
                                <circle id="progress" class="text-white transition-all duration-75" stroke-width="2" stroke-dasharray="289" stroke-dashoffset="289" stroke-linecap="round" stroke="currentColor" fill="transparent" r="46" cx="48" cy="48"/>
                            </svg>
                        </div>
                    </div>
                </div>
            `;

            // Sentence-by-sentence animation for readability
            const textEl = document.getElementById('vis-text');
            // Split logic to keep punctuation
            const rawSentences = data.visual.match( /[^\.!\?]+[\.!\?]+/g ) || [data.visual];
            
            textEl.innerHTML = rawSentences.map(s => `<div class="line-blur mb-4">${s.trim()}</div>`).join("");
            
            const els = document.querySelectorAll('.line-blur');
            let delay = 0;
            els.forEach((el, i) => {
                setTimeout(() => el.classList.add('visible'), 500 + (i * 1200));
                delay = 500 + (i * 1200);
            });

            setTimeout(() => {
                document.getElementById('action-area').classList.remove('opacity-0');
                setupHoldListener(document.getElementById('hold-btn'));
            }, delay + 1500);
        }

        // --- Interaction Logic (Hold Button) ---
        function setupHoldListener(btn) {
            const circle = document.getElementById('progress');
            const total = 289;
            
            const start = (e) => {
                if (e.cancelable) e.preventDefault();
                isHolding = true;
                vibrate(30);
                loop();
            };
            const end = () => {
                isHolding = false;
                progress = 0;
                circle.style.strokeDashoffset = total;
                cancelAnimationFrame(animFrame);
            };

            const loop = () => {
                if(!isHolding) return;
                progress += 1.5;
                const offset = total - (progress / 100) * total;
                circle.style.strokeDashoffset = offset;
                
                if(Math.floor(progress) % 20 === 0) vibrate(5);

                if(progress >= 100) {
                    isHolding = false;
                    vibrate([50, 100]);
                    transitionTo(renderMantra);
                } else {
                    animFrame = requestAnimationFrame(loop);
                }
            };

            btn.addEventListener('mousedown', start);
            btn.addEventListener('touchstart', start, {passive: false});
            btn.addEventListener('mouseup', end);
            btn.addEventListener('touchend', end);
            btn.addEventListener('mouseleave', end);
        }

        // --- SCENE 4: The Mantra ---
        function renderMantra() {
            const data = promises[currentIdx];
            container.innerHTML = `
                <div class="fade-enter flex flex-col items-center justify-center h-full w-full px-4">
                    <div class="min-h-[200px] flex items-center justify-center">
                        <h2 class="serif text-3xl md:text-4xl gold-text text-center leading-normal tracking-wide drop-shadow-lg" id="mantra-text"></h2>
                    </div>
                    
                    <button id="next-btn" class="mt-16 opacity-0 px-8 py-3 border-b border-white/20 text-xs uppercase tracking-[0.3em] text-white/50 hover:text-white hover:border-white transition-all">
                        Proceed
                    </button>
                </div>
            `;

            // Word-by-word animation for the Mantra
            const totalTime = renderWordByWord(document.getElementById('mantra-text'), `"${data.mantra}"`, 500);

            setTimeout(() => {
                const btn = document.getElementById('next-btn');
                btn.classList.remove('opacity-0');
                btn.classList.add('transition-opacity', 'duration-1000');
                btn.addEventListener('click', () => {
                    vibrate(20);
                    currentIdx++;
                    if(currentIdx < promises.length) transitionTo(renderExperience);
                    else transitionTo(renderFinale);
                });
            }, totalTime + 1000);
        }

        // --- SCENE 5: Finale ---
        function renderFinale() {
            setColor('#ffffff');
            container.innerHTML = `
                <div class="fade-enter flex flex-col items-center justify-center h-full max-w-md w-full p-6">
                    <div class="w-32 h-32 rounded-full bg-white/10 blur-[80px] animate-pulse mb-8 absolute"></div>
                    
                    <h1 class="serif text-4xl mb-8 text-white z-10" id="final-title"></h1>
                    
                    <div class="glass-box p-10 rounded-xl w-full text-center z-10">
                        <p class="serif text-xl text-slate-200 leading-relaxed font-light mb-6" id="final-text"></p>
                        <div class="h-px w-10 bg-white/20 mx-auto mb-6"></div>
                        <p class="text-[10px] text-white/40 uppercase tracking-widest">
                            Promise Day 2026
                        </p>
                    </div>
                </div>
            `;
            
            // Animate Finale Title Word-by-Word
            renderWordByWord(document.getElementById('final-title'), "Welcome Home.", 500);
            
            // Animate Finale Quote Sentence-by-Sentence
            setTimeout(() => {
                const quote = "You have spent your whole life looking for a place to rest. You didn't realize that you are the home you were looking for.";
                const textEl = document.getElementById('final-text');
                textEl.innerHTML = `<div class="line-blur">${quote}</div>`;
                setTimeout(() => textEl.firstChild.classList.add('visible'), 100);
            }, 1500);
            
            vibrate([100, 50, 100, 50, 200]);
        }

        // --- Transitions ---
        function transitionTo(fn) {
            container.classList.add('fade-exit');
            setTimeout(() => {
                container.innerHTML = '';
                container.classList.remove('fade-exit');
                fn();
            }, 1000);
        }

        // Init
        window.onload = renderInstructions;

    </script>
</body>
</html>
